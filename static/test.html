<!DOCTYPE html>
<html lang="en">
<head>
<script type="text/javascript" src="/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="/heatmap.js"></script>
<script type="text/javascript" src="/heatmap-gmaps.js"></script>
<script type="text/javascript" src="/ring-buffer.js"></script>
<script type="text/javascript">
window.onload = function(){
    // standard gmaps initialization
    var myLatlng = new google.maps.LatLng(53, -8);
    // define map properties
    var myOptions = {
      zoom: 6,
      center: myLatlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      disableDefaultUI: false,
      scrollwheel: false,
      draggable: false,
      navigationControl: false,
      mapTypeControl: false,
      scaleControl: false,
      disableDoubleClickZoom: true
    };
    var map = new google.maps.Map($("#heatmap")[0], myOptions);
    var heatmap = new HeatmapOverlay(map, {
        "radius":10,
        "visible":true, 
        "opacity":100,
        "gradient": { 0.0: "blue", 1.0: "red" }
    });

 
    var initial_data={ max: 100, data: [] };
    google.maps.event.addListener(map, "idle", function(){ heatmap.setDataSet(initial_data); });
 
 	var ringbuf = new RingBuffer(3);
 	var evtSource = new EventSource("/tweets");
    evtSource.onmessage = function(message) {
    	var tweet = JSON.parse(message.data);
    	//$('#tweets').append('<li>' + tweet['text'] + '</li>');
    	//console.log(tweet['coordinates'][0] + ' ' + tweet['coordinates'][1]);
    	var data_point = [tweet['coordinates'][1], tweet['coordinates'][0], 50];
    	ringbuf.push(data_point);
    	//heatmap.addDataPoint(data_point[0], data_point[1], data_point[2]);
    	heatmap.setDataSet(ringbuf.get_array());
	}
};
</script>
</head>
<body>
	<div id="heatmap" class="well" style="width:610px;padding:0;height:400px;position:relative;"></div>
	<ul id="tweets"></ul>
</body>
</html>